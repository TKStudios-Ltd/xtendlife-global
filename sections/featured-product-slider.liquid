{% comment %} Featured Product Slider â€” 1 product per slide (works with global swiper-hydrator) {% endcomment %}

{%- style -%}
  .section-{{ section.id }}-padding{
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
@media (min-width:750px){
  .section-{{ section.id }}-padding{
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  }
  .section-{{ section.id }}-padding .extra-padding {
    padding: 5rem 8rem;
  }
}
.fps-{{ section.id }}-head { 
  display:flex; 
  align-items: flex-start;
  justify-content:space-between;
  gap:1rem;
  margin-bottom:1.5rem;
}
.fps-{{ section.id }}-heading{ 
    margin: 0;
    max-width: 540px;
    line-height: 1.2;
}
.fps-{{ section.id }}-arrows{ display:flex; gap: 1rem; }
.fps-{{ section.id }}-btn {
    appearance: none;
    border: none;
    background: transparent;
    width: 50px;
    height: 50px;
    cursor: pointer;
}
.fps-{{ section.id }}-btn.swiper-button-disabled {
    opacity: 0.5;
}

  /* Swiper base */
  .fps-{{ section.id }}-swiper{ width:100%; --g: {{ section.settings.gap | default: 24 }}px; }
  .fps-{{ section.id }}-swiper .swiper-wrapper{ display:flex; }
  .fps-{{ section.id }}-swiper .swiper-slide{ height:auto; width: calc(100% - var(--g)); }

.fps-{{ section.id }}-card{
    width: 100%;
    display: grid; 
    align-items: center;
    gap: 8vw;
    grid-template-columns: 1fr 1fr;
}
@media (max-width: 990px){
    .fps-{{ section.id }}-card{ grid-template-columns: 1fr; }
}
.fps-{{ section.id }}-media{ 
  height: 40vw;
  max-height: 600px;
  padding: 4rem;
  border-radius:12px; 
  overflow:hidden; 
  background:#f5f5f5; 
}
.fps-{{ section.id }}-media img{ width:100%; height:100%; object-fit:contain; display:block; }
.fps .rating-star {
  --letter-spacing: 0;
  --font-size: 1.6;
}
.fps-{{ section.id }}-title { 
  margin: 1.5rem 0 0; 
}
.fps-{{ section.id }}-title a {
  color: inherit;
  text-decoration: none;
}
.fps .product-hero__summary { margin: 1.5rem 0 2rem; }
.fps p.inline-richtext { font-size: 1.2rem; margin-top: 2rem; }
.fps-{{ section.id }}-meta{ display:flex; align-items:center; gap:1rem; flex-wrap:wrap; }
.fps-{{ section.id }}-cta{ margin-top:1rem; }
.fps .product-benefits__icons { margin: 1rem 0 0; }
.fps .product-benefits__icons .product-benefits__icon { flex: 0 0 calc(33.3333% - 3rem); }
.fps .product-form__buy-row {
  display: flex;
  gap: 1.5rem;
  margin-top: 2rem;
  align-items: center;
  flex-wrap: wrap;
}
.fps .product-form__quantity-wrap {
  flex: 0 0 160px;
}
.fps .product-form__quantity-wrap .quantity {
  width: 160px !important;
  min-height: 38px !important;
  border: 2px solid;
  border-radius: 40px !important;
}
.fps .product-form__quantity-wrap .quantity:before,
.fps .product-form__quantity-wrap .quantity:after,
.fps .form__label {
  display: none;
}
.fps .product-form__submit-wrap {
  display: flex;
  flex: 0 0 calc(100% - 180px);
}
.fps .product-form__submit {
  width: 100%;
  min-height: 24px;
}
.fps-{{ section.id }}-bleed{ width:100%; }
@media (min-width: 1600px){
  .fps-{{ section.id }}-bleed{
    width: calc(100vw - ((100vw - 1600px)/2));
  }
}
@media (max-width: 749px) {
  .fps-{{ section.id }}-arrows button,
  .fps-{{ section.id }}-arrows button svg {
    width: 34px;
    height: 34px;
  }
  .fps-{{ section.id }}-head {
    margin-bottom: 4rem;
  }
  .fps-{{ section.id }}-title { 
    margin: 0.5rem 0 0; 
  }
}
{%- endstyle -%}

<section class="section-{{ section.id }}-padding">
  <div class="page-width extra-padding">
    <div class="fps-{{ section.id }}-head">
      <h2 class="fps-{{ section.id }}-heading h1 scroll-trigger animate--slide-in">{{ section.settings.heading | escape }}</h2>
      {% if section.settings.show_arrows %}
        <div class="fps-{{ section.id }}-arrows">
            <button class="fps-{{ section.id }}-btn ts-prev" aria-label="Previous">
                <svg width="49" height="49" viewBox="0 0 49 49" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M45.9375 24.5C45.9375 24.0939 45.7762 23.7044 45.489 23.4172C45.2018 23.1301 44.8124 22.9687 44.4062 22.9687H8.2902L17.9279 13.3341C18.2154 13.0466 18.3769 12.6566 18.3769 12.25C18.3769 11.8434 18.2154 11.4534 17.9279 11.1659C17.6403 10.8783 17.2504 10.7168 16.8438 10.7168C16.4371 10.7168 16.0472 10.8783 15.7596 11.1659L3.5096 23.4159C3.367 23.5581 3.2539 23.7271 3.1767 23.9131C3.0995 24.0991 3.0598 24.2986 3.0598 24.5C3.0598 24.7014 3.0995 24.9008 3.1767 25.0869C3.2539 25.2729 3.367 25.4419 3.5096 25.5841L15.7596 37.8341C16.0472 38.1216 16.4371 38.2832 16.8438 38.2832C17.2504 38.2832 17.6403 38.1216 17.9279 37.8341C18.2154 37.5466 18.3769 37.1566 18.3769 36.75C18.3769 36.3434 18.2154 35.9534 17.9279 35.6659L8.2902 26.0312H44.4062C44.8124 26.0312 45.2018 25.8699 45.489 25.5828C45.7762 25.2956 45.9375 24.9061 45.9375 24.5Z" fill="#1F1946"/>
                </svg>
            </button>
            <button class="fps-{{ section.id }}-btn ts-next" aria-label="Next">
                <svg width="49" height="49" viewBox="0 0 49 49" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M3.0625 24.4995C3.0625 24.0934 3.22383 23.7039 3.51099 23.4167C3.79816 23.1296 4.18764 22.9682 4.59375 22.9682H40.7098L31.0721 13.3336C30.7846 13.0461 30.6231 12.6561 30.6231 12.2495C30.6231 11.8429 30.7846 11.4529 31.0721 11.1654C31.3597 10.8778 31.7496 10.7163 32.1562 10.7163C32.5629 10.7163 32.9528 10.8778 33.2404 11.1654L45.4904 23.4154C45.633 23.5576 45.7461 23.7266 45.8233 23.9126C45.9005 24.0986 45.9402 24.2981 45.9402 24.4995C45.9402 24.7009 45.9005 24.9003 45.8233 25.0864C45.7461 25.2724 45.633 25.4414 45.4904 25.5836L33.2404 37.8336C32.9528 38.1211 32.5629 38.2827 32.1562 38.2827C31.7496 38.2827 31.3597 38.1211 31.0721 37.8336C30.7846 37.5461 30.6231 37.1561 30.6231 36.7495C30.6231 36.3429 30.7846 35.9529 31.0721 35.6654L40.7098 26.0307H4.59375C4.18764 26.0307 3.79816 25.8694 3.51099 25.5823C3.22383 25.2951 3.0625 24.9056 3.0625 24.4995Z" fill="#1F1946"/>
                </svg>
            </button>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- slider starts inside page-width then bleeds to right edge -->
  <div class="page-width extra-padding">
    <div class="fps">
      <div
        class="swiper tswiper fps-{{ section.id }}-swiper"
        data-mode="fixed"
        data-gap="{{ section.settings.gap | default: 24 }}"
        data-speed="{{ section.settings.speed | default: 500 }}"
        data-autoplay="{{ section.settings.autoplay | default: false }}"
        data-autoplay-delay="{{ section.settings.autoplay_delay | default: 4000 }}"
      >
        <div class="swiper-wrapper">
          {%- assign limit = section.settings.limit | default: 6 -%}
          {%- if section.settings.collection and section.settings.collection.products_count > 0 -%}
            {%- for p in section.settings.collection.products limit: limit -%}
              {%- assign pid = p.id -%}
              {%- assign form_id = 'product-form-' | append: section.id | append: '-' | append: pid -%}
              <div class="swiper-slide">
                <article class="fps-{{ section.id }}-card">
                  <!-- Media -->
                  <div class="fps-{{ section.id }}-media">
                    {%- assign fm = p.selected_or_first_available_variant.featured_media | default: p.featured_media -%}
                    {% if fm %}
                      {{ fm | image_url: width: 1400 | image_tag:
                          loading: 'lazy',
                          sizes: '(min-width: 990px) 700px, 100vw',
                          widths: '500,700,900,1200,1400',
                          alt: p.title | escape }}
                    {% else %}
                      {{ 'product-apparel-1' | placeholder_svg_tag: 'placeholder-svg' }}
                    {% endif %}
                  </div>

                  <!-- Info -->
                  <div class="fps-{{ section.id }}-info">
                    <product-info
                      data-section="{{ section.id }}-{{ pid }}"
                      data-product-id="{{ p.id }}"
                      data-update-url="false"
                      data-url="{{ p.url }}"
                    >
                      {{ 'component-price.css' | asset_url | stylesheet_tag }}
                      {{ 'component-volume-pricing.css' | asset_url | stylesheet_tag }}
                      {{ 'section-main-product.css' | asset_url | stylesheet_tag }}
                      {% unless p.has_only_default_variant %}
                        {{ 'component-product-variant-picker.css' | asset_url | stylesheet_tag }}
                        {{ 'component-swatch.css' | asset_url | stylesheet_tag }}
                        {{ 'component-swatch-input.css' | asset_url | stylesheet_tag }}
                      {% endunless %}

                      {%- for block in section.blocks -%}
                        {%- case block.type -%}

                          {%- when 'text' -%}
                            <p class="inline-richtext{% if block.settings.text_style == 'uppercase' %} caption-with-letter-spacing{% elsif block.settings.text_style == 'subtitle' %} subtitle{% endif %}">
                              {{ block.settings.text }}
                            </p>

                          {%- when 'title' -%}
                            <h3 class="fps-{{ section.id }}-title {{ block.settings.heading_size }}">
                              <a href="{{ p.url }}">{{ p.title | escape }}</a>
                            </h3>
                            <span class="product__subheading">{{ p.metafields.custom_fields.option_text | remove: 'Size:' }}</span>

                            {%- if p.metafields.custom_fields.product_summary != blank -%}
                              {%- assign product_summary = p.metafields.custom_fields.product_summary -%}
                            {%- endif -%}
                            {%- if product_summary != blank -%}
                              <div class="product-hero__summary">{{ product_summary }}</div>
                            {% endif %}

                          {%- when 'price' -%}
                            <div id="price-{{ section.id }}-{{ pid }}" class="fps-{{ section.id }}-meta" role="status">
                              {% render 'price', product: p, use_variant: true, show_badges: true, price_class: 'price--large' %}
                            </div>
                            {% if p.quantity_price_breaks_configured? %}
                              <div class="volume-pricing-note"><span>{{ 'products.product.volume_pricing.note' | t }}</span></div>
                            {% endif %}

                          {%- when 'sku' -%}
                            <p
                              class="{% if block.settings.text_style == 'uppercase' %}caption-with-letter-spacing{% elsif block.settings.text_style == 'subtitle' %}subtitle{% endif %}{% if p.selected_or_first_available_variant.sku.size == 0 %} visibility-hidden{% endif %}"
                              id="Sku-{{ section.id }}-{{ pid }}"
                              role="status"
                            >
                              <span class="visually-hidden">{{ 'products.product.sku' | t }}:</span>
                              {{- p.selected_or_first_available_variant.sku -}}
                            </p>

                          {%- when 'variant_picker' -%}
                            {% render 'product-variant-picker', product: p, block: block, product_form_id: form_id %}

                          {%- when 'quantity_selector' -%}
                            {% assign cart_qty = cart | item_count_for_variant: p.selected_or_first_available_variant.id %}
                            <div id="Quantity-Form-{{ section.id }}-{{ pid }}" class="product-form__input product-form__quantity">
                              <label class="quantity__label form__label" for="Quantity-{{ section.id }}-{{ pid }}">
                                <span aria-hidden="true">{{ 'products.product.quantity.label' | t }}</span>
                              </label>
                              <div class="price-per-item__container">
                                <quantity-input class="quantity">
                                  <button class="quantity__button" name="minus" type="button">
                                    <span class="visually-hidden">{{ 'products.product.quantity.decrease' | t: product: p.title | escape }}</span>
                                    <span class="svg-wrapper">{{ 'icon-minus.svg' | inline_asset_content }}</span>
                                  </button>
                                  <input class="quantity__input" type="number" name="quantity" id="Quantity-{{ section.id }}-{{ pid }}"
                                         data-cart-quantity="{{ cart_qty }}"
                                         data-min="{{ p.selected_or_first_available_variant.quantity_rule.min }}"
                                         min="{{ p.selected_or_first_available_variant.quantity_rule.min }}"
                                         {% if p.selected_or_first_available_variant.quantity_rule.max != null %}
                                           data-max="{{ p.selected_or_first_available_variant.quantity_rule.max }}"
                                           max="{{ p.selected_or_first_available_variant.quantity_rule.max }}"
                                         {% endif %}
                                         step="{{ p.selected_or_first_available_variant.quantity_rule.increment }}"
                                         value="{{ p.selected_or_first_available_variant.quantity_rule.min }}"
                                         form="{{ form_id }}">
                                  <button class="quantity__button" name="plus" type="button">
                                    <span class="visually-hidden">{{ 'products.product.quantity.increase' | t: product: p.title | escape }}</span>
                                    <span class="svg-wrapper">{{ 'icon-plus.svg' | inline_asset_content }}</span>
                                  </button>
                                </quantity-input>
                              </div>
                            </div>

                          {%- when 'buy_buttons' -%}
                            {% render 'buy-buttons',
                              block: block,
                              product: p,
                              product_form_id: form_id,
                              section_id: section.id | append: '-' | append: pid,
                              show_pickup_availability: false
                            %}

                          {%- when 'share' -%}
                            {% liquid
                              assign share_url = p.selected_variant.url | default: p.url | prepend: request.origin
                              render 'share-button', block: block, share_link: share_url
                            %}

                          {%- when 'custom_liquid' -%}
                            {{ block.settings.custom_liquid }}

                          {%- when 'rating' -%}
                            {%- liquid
                              assign rating_obj = p.metafields.reviews.rating.value
                              assign rating_count = p.metafields.reviews.rating_count.value | default: p.metafields.reviews.rating_count
                            -%}

                            {%- if rating_obj and rating_count and rating_count > 0 -%}
                              {%- liquid
                                assign rating = rating_obj.rating
                                assign scale_max = rating_obj.scale_max | default: 5

                                assign rating_decimal = 0
                                assign decimal = rating | modulo: 1
                                if decimal >= 0.3 and decimal <= 0.7
                                  assign rating_decimal = 0.5
                                elsif decimal > 0.7
                                  assign rating_decimal = 1
                                endif
                              -%}

                              <div class="rating-wrapper">
                                <div class="rating__wrapper">
                                  <div class="rating" role="img" aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: rating, rating_max: scale_max }}">
                                    <span aria-hidden="true"
                                      class="rating-star"
                                      style="--rating: {{ rating | floor }}; --rating-max: {{ scale_max }}; --rating-decimal: {{ rating_decimal }};"></span>
                                  </div>

                                  <p class="rating-text caption">
                                    <span aria-hidden="true">{{- rating }} / {{ scale_max -}}</span>
                                  </p>

                                  <p class="rating-count caption">
                                    <span aria-hidden="true">Based on {{ rating_count }} reviews</span>
                                    <span class="visually-hidden">
                                      {{- rating_count -}} {{ 'accessibility.total_reviews' | t -}}
                                    </span>
                                  </p>
                                </div>
                              </div>
                            {%- endif -%}

                          {%- when 'icon-with-text' -%}
                            <h4>Key Benefits</h4>
                            {%- assign benefits = p.metafields.custom.key_benefits.value -%}

                            {%- if benefits != blank -%}
                              <div class="product-benefits__icons">
                                {%- for entry in benefits -%}
                                  {%- comment -%}
                                    Try multiple access patterns just in case the metaobject fields are exposed as
                                    direct fields or under `fields`.
                                  {%- endcomment -%}
                                  {%- assign text = entry.benefit_text | default: entry['benefit_text'] | default: entry.fields.benefit_text -%}
                                  {%- assign icon = entry.icon_image   | default: entry['icon_image']   | default: entry.fields.icon_image   -%}

                                  <div class="product-benefits__icon">
                                    {%- if icon != blank -%}
                                      {{ icon | image_url: width: 160 | image_tag: alt: text }}
                                    {%- endif -%}
                                    {%- if text != blank -%}
                                      <p>{{ text }}</p>
                                    {%- endif -%}
                                  </div>
                                {%- endfor -%}
                              </div>
                            {%- endif -%}

                        {%- endcase -%}
                      {%- endfor -%}
                    </product-info>
                  </div>
                </article>
              </div>
            {%- endfor -%}
          {%- else -%}
            {%- comment -%} Fallback placeholders when no collection selected {%- endcomment -%}
            {%- for i in (1..3) -%}
              <div class="swiper-slide">
                <article class="fps-{{ section.id }}-card">
                  <div class="fps-{{ section.id }}-media">{{ 'product-apparel-1' | placeholder_svg_tag: 'placeholder-svg' }}</div>
                  <div class="fps-{{ section.id }}-info">
                    <h3 class="fps-{{ section.id }}-title h3">Featured product</h3>
                    <div class="price">$99.00</div>
                    <a class="button button--primary fps-{{ section.id }}-cta" href="#">Shop now</a>
                  </div>
                </article>
              </div>
            {%- endfor -%}
          {%- endif -%}
        </div>
      </div>
    </div>
  </div>

  {%- comment -%} Dawn JS used by blocks above {%- endcomment -%}
  <script src="{{ 'product-info.js' | asset_url }}" defer></script>
  <script src="{{ 'product-form.js' | asset_url }}" defer></script>
  <script src="{{ 'price-per-item.js' | asset_url }}" defer></script>
  <script src="{{ 'show-more.js' | asset_url }}" defer></script>
</section>

{% schema %}
{
  "name": "Featured product slider",
  "class": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Featured products" },
    { "type": "collection", "id": "collection", "label": "Collection" },
    { "type": "range", "id": "limit", "label": "Products to show", "min": 1, "max": 12, "step": 1, "default": 6 },

    { "type": "text", "id": "view_details_label", "label": "View details label", "default": "View full details" },

    { "type": "checkbox", "id": "show_arrows", "label": "Show arrows", "default": true },
    { "type": "range", "id": "gap", "label": "Slide gap (px)", "min": 0, "max": 48, "step": 2, "default": 24 },
    { "type": "range", "id": "speed", "label": "Transition speed (ms)", "min": 100, "max": 1200, "step": 50, "default": 500 },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false },
    { "type": "range", "id": "autoplay_delay", "label": "Autoplay delay (ms)", "min": 1500, "max": 8000, "step": 100, "default": 4000 },

    { "type": "header", "content": "Section padding" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding top", "default": 48 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding bottom", "default": 48 }
  ],
  "blocks": [
    { "type": "text", "name": "Text", "settings": [ { "type": "inline_richtext", "id": "text", "label": "Text", "default": "Brand" }, { "type": "select", "id": "text_style", "label": "Style", "default": "body", "options": [ { "value":"body","label":"Body" }, { "value":"subtitle","label":"Subtitle" }, { "value":"uppercase","label":"Uppercase" } ] } ] },
    { "type": "title", "name": "Title", "limit": 1, "settings": [ { "type": "select", "id": "heading_size", "label": "Heading size", "default": "h2", "options": [ { "value": "h2", "label": "H2" }, { "value": "h1", "label": "H1" }, { "value": "h0", "label": "H0" }, { "value": "hxl", "label": "HXL" }, { "value": "hxxl", "label": "HXXL" } ] } ] },
    { "type": "price", "name": "Price", "limit": 1 },
    { "type": "sku", "name": "SKU", "limit": 1, "settings": [ { "type": "select", "id": "text_style", "label": "Style", "default": "body", "options": [ { "value": "body", "label": "Body" }, { "value": "subtitle", "label": "Subtitle" }, { "value": "uppercase", "label": "Uppercase" } ] } ] },
    { "type": "variant_picker", "name": "Variant picker", "limit": 1, "settings": [ { "type": "select", "id": "picker_type", "label": "Picker", "default": "button", "options": [ { "value": "dropdown", "label": "Dropdown" }, { "value": "button", "label": "Buttons" } ] }, { "type": "select", "id": "swatch_shape", "label": "Swatch shape", "default": "circle", "options": [ { "value":"circle","label":"Circle" }, { "value":"square","label":"Square" }, { "value":"none","label":"None" } ] } ] },
    { "type": "quantity_selector", "name": "Quantity selector", "limit": 1 },
    { "type": "buy_buttons", "name": "Buy buttons", "limit": 1, "settings": [ { "type": "checkbox", "id": "show_dynamic_checkout", "default": true, "label": "Show dynamic checkout" }, { "type": "checkbox", "id": "show_gift_card_recipient", "default": true, "label": "Gift card recipient (if applicable)" } ] },
    { "type": "share", "name": "Share", "limit": 1, "settings": [ { "type":"text", "id":"share_label", "label":"Label", "default":"Share" } ] },
    { "type": "custom_liquid", "name": "Custom liquid", "settings": [ { "type": "liquid", "id": "custom_liquid", "label": "Liquid" } ] },
    { "type": "rating", "name": "Rating", "limit": 1 },
    { "type": "icon-with-text", "name": "Icon with text", "settings": [ { "type": "select", "id": "layout", "label": "Layout", "default": "horizontal", "options": [ { "value": "horizontal", "label": "Horizontal" }, { "value": "vertical", "label": "Vertical" } ] } ] }
  ],
  "presets": [{ "name": "Featured product slider" }]
}
{% endschema %}
