{% comment %} Mixed Media Slider (Videos + E-books with tabs) {% endcomment %}

{%- liquid
  assign tab_video_label = section.settings.tab_video_label | default: 'Videos'
  assign tab_ebook_label = section.settings.tab_ebook_label | default: 'E-books'
  assign default_tab = section.settings.default_tab | default: 'videos'

  assign has_videos = false
  assign has_ebooks = false
  for block in section.blocks
    if block.type == 'video_slide'
      assign has_videos = true
    elsif block.type == 'ebook_slide'
      assign has_ebooks = true
    endif
  endfor

  assign active_tab = default_tab

    assign valid_active = false
    if active_tab == 'videos' and has_videos
    assign valid_active = true
    elsif active_tab == 'ebooks' and has_ebooks
    assign valid_active = true
    endif

    if valid_active == false
    if has_videos
        assign active_tab = 'videos'
    elsif has_ebooks
        assign active_tab = 'ebooks'
    else
        assign active_tab = ''
    endif
    endif
-%}

{%- style -%}
.section-{{ section.id }}-padding{
  padding-top:{{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
  padding-bottom:{{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  overflow-x: clip;
}
@media (min-width:750px){
  .section-{{ section.id }}-padding{
    padding-top:{{ section.settings.padding_top }}px;
    padding-bottom:{{ section.settings.padding_bottom }}px;
  }
}

/* Heading */
#mixed-media-slider-{{ section.id }} .ts2-heading{
  margin: 0; /* IMPORTANT: kill the 8rem bottom margin */
}

/* Right-bleed like testimonial */
#mixed-media-slider-{{ section.id }} .ts2-bleed { width: calc(100vw - ((100vw - 1400px) / 2)); }
@media (min-width: 990px) and (max-width: 1399px) {
  #mixed-media-slider-{{ section.id }} .ts2-bleed{ width: calc(100% + var(--right-gutter)); margin-right: -2rem; }
}
@media (max-width: 989px) {
  #mixed-media-slider-{{ section.id }} .ts2-bleed { width: 100% !important; margin-right: -2rem; }
  #mixed-media-slider-{{ section.id }} .ts2-swiper[data-mode="fixed"] .swiper-slide{ width: 100% !important; }
  #mixed-media-slider-{{ section.id }} .ts2-card { padding: 2rem 2rem 3rem !important; }
  #mixed-media-slider-{{ section.id }} .ms-controls { margin-top: 2rem !important; margin-right: 0 !important; }
  #mixed-media-slider-{{ section.id }} .ms-media { aspect-ratio: 1 / 1 !important; }
}

/* Tabs */
/* Title row layout */
#mixed-media-slider-{{ section.id }} .ms-title-row{
  display: flex;
  align-items: center;          /* same baseline-ish */
  justify-content: space-between;
  gap: 2rem;
  margin-bottom: 4rem;          /* replaces the heading's old 8rem margin */
}
#mixed-media-slider-{{ section.id }} .ms-tabs{
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  justify-content: flex-end;
}
#mixed-media-slider-{{ section.id }} .ms-tab{
  appearance:none; background:#fff;
  color:inherit; border-radius:999px; padding:.75rem 1.75rem; cursor:pointer;
}
#mixed-media-slider-{{ section.id }} .ms-tab[aria-selected="true"]{
  background:#1F1946; color:#fff; border-color:#1F1946;
}
#mixed-media-slider-{{ section.id }} .ms-panel[hidden]{ display:none !important; }

/* Swiper fallbacks */
#mixed-media-slider-{{ section.id }} .ts2-swiper{ overflow: visible; --g: {{ section.settings.gap | default: 32 }}px; }
#mixed-media-slider-{{ section.id }} .ts2-swiper .swiper-wrapper{ display:flex; }
#mixed-media-slider-{{ section.id }} .ts2-swiper .swiper-slide{ flex-shrink:0; height:auto; }

/* Dim only slides not in view */
#mixed-media-slider-{{ section.id }} .ts2-swiper[data-mode="fixed"] .swiper-slide{
  width: calc((100% - var(--g)) / 1.2);
}
#mixed-media-slider-{{ section.id }} .ts2-swiper .swiper-slide.swiper-slide-active .ms-media,
#mixed-media-slider-{{ section.id }} .ts2-swiper .swiper-slide.swiper-slide-active .ts2-copy { opacity: 1; }
#mixed-media-slider-{{ section.id }} .ts2-swiper .swiper-slide.swiper-slide-next .ms-media,
#mixed-media-slider-{{ section.id }} .ts2-swiper .swiper-slide.swiper-slide-next .ts2-copy,
#mixed-media-slider-{{ section.id }} .ts2-swiper .swiper-slide.swiper-slide-prev .ms-media,
#mixed-media-slider-{{ section.id }} .ts2-swiper .swiper-slide.swiper-slide-prev .ts2-copy { opacity: 0.3; }

/* Mobile: heading above buttons, centered */
@media (max-width: 749px){
  #mixed-media-slider-{{ section.id }} .ms-title-row{
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    margin-bottom: 2.5rem;
  }

  #mixed-media-slider-{{ section.id }} .ms-tabs{
    justify-content: center;
  }
}

/* Card */
#mixed-media-slider-{{ section.id }} .ts2-card{
  background: #fff;
  border-radius: 16px;
  padding: 2rem 5rem 2rem 2rem;
  display: grid;
  grid-template-columns: 380px 1fr;
  gap: 5rem;
  align-items: center;
}
@media (max-width: 989px){
  #mixed-media-slider-{{ section.id }} .ts2-card{ grid-template-columns: 1fr; gap: 3rem; }
  #mixed-media-slider-{{ section.id }} .ts2-role{ font-size: 28px !important; }
  #mixed-media-slider-{{ section.id }} .ts2-name{ font-size: 18px !important; }
  #mixed-media-slider-{{ section.id }} .ts2-quote{ font-size: 18px !important; }
}

/* Media + overlay */
#mixed-media-slider-{{ section.id }} .ms-media{
  position: relative; border-radius: 10px; overflow:hidden;
  aspect-ratio: 4 / 5; background: #f3f4f6;
}
#mixed-media-slider-{{ section.id }} .ms-media img{ width:100%; height:100%; object-fit:cover; display:block; }
#mixed-media-slider-{{ section.id }} .ms-overlay{ position:absolute; inset:0; display:none; place-items:center; }
#mixed-media-slider-{{ section.id }} .swiper-slide-active .ms-overlay{ display:grid; }

#mixed-media-slider-{{ section.id }} .ms-overlay button,
#mixed-media-slider-{{ section.id }} .ms-overlay a{
  appearance: none;
  border: 0;
  background: rgba(31, 25, 70, 1);
  width: 90px;
  height: 90px;
  border-radius: 999px;
  padding: 0;
  cursor: pointer;
  display: grid;
  place-items: center;
  transform: scale(1);
  transition: transform .4s ease;
  text-decoration: none;
}
#mixed-media-slider-{{ section.id }} .ms-media:hover .ms-overlay button,
#mixed-media-slider-{{ section.id }} .ms-media:hover .ms-overlay a{
  transform: scale(1.05);
}
#mixed-media-slider-{{ section.id }} .ms-overlay svg{
  width: 100%;
  height: 42px;
}

/* Copy */
#mixed-media-slider-{{ section.id }} .ts2-pill {
  font-size: 10px;
  font-weight: 500;
  text-transform: uppercase;
  background: rgba(219, 238, 255, 1);
  padding: 0.5rem 1.25rem 0.35rem;
  letter-spacing: 0.5px;
  margin-bottom: 0.75rem;
  display: inline-block;
  border-radius: 99px;
}
#mixed-media-slider-{{ section.id }} .ts2-role{ font-size: 36px; font-weight: 500; line-height: 1.2; margin: 0 0 1rem; }
#mixed-media-slider-{{ section.id }} .ts2-name{ font-size: 20px; line-height: 1.35; margin: 0 0 2rem; }
#mixed-media-slider-{{ section.id }} .ts2-quote{ font-size: 20px; line-height: 1.35; margin: 0; }

/* Controls bar (arrows left, dots right) */
#mixed-media-slider-{{ section.id }} .ms-controls{
  display:flex; justify-content:space-between; align-items:center; gap:1.5rem;
  margin-top: 4rem; max-width: 1400px; margin-right: 2rem;
}
#mixed-media-slider-{{ section.id }} .ms-arrows{ display:flex; gap: 1rem; }
#mixed-media-slider-{{ section.id }} .ms-btn{
  appearance:none; border:none; background:transparent; cursor:pointer;
  width: 50px; height: 50px; padding: 0;
}
#mixed-media-slider-{{ section.id }} .ms-btn.swiper-button-disabled{ opacity:.5; pointer-events:none; }

/* Dots (right aligned) */
#mixed-media-slider-{{ section.id }} .ts2-pagination{ display:flex; text-align:right; }
#mixed-media-slider-{{ section.id }} .ts2-pagination .swiper-pagination-bullet{
  width: 10px; height: 10px; border-radius: 999px; background: #DBEEFF; opacity: 1; margin: 0 6px !important;
}
#mixed-media-slider-{{ section.id }} .ts2-pagination .swiper-pagination-bullet-active{
  background: #1F1946; width: 46px;
}

/* Modal */
#mixed-media-slider-{{ section.id }} .ms-modal{
  position: fixed; inset: 0; z-index: 9999; display: none; background: rgba(31, 25, 70, 0.7); padding: 3vw;
}
#mixed-media-slider-{{ section.id }} .ms-modal[aria-hidden="false"]{ display: grid; place-items: center; }
#mixed-media-slider-{{ section.id }} .ms-modal__box{
  position: relative; width: min(1000px, 100%); aspect-ratio: 16/9; background: #FFF;
  border-radius: 10px; overflow: hidden;
}
#mixed-media-slider-{{ section.id }} .ms-modal__box iframe{ position: absolute; inset: 0; width:100%; height:100%; border:0; }
#mixed-media-slider-{{ section.id }} .ms-close{
  position: absolute; top: 8px; right: 8px; appearance:none; border:0; background: rgba(31, 25, 70, 1);
  color:#fff; width: 40px; height: 40px; border-radius: 999px; cursor: pointer; display:grid; place-items:center;
}
{%- endstyle -%}

<section id="mixed-media-slider-{{ section.id }}" class="section-{{ section.id }}-padding" style="{% if section.settings.bg_color != blank %}background-color: {{ section.settings.bg_color }};{% endif %}">
  <div class="page-width">
    <div class="ms-title-row">
      {% if section.settings.heading != blank %}
        <h2 class="ts2-heading h2">{{ section.settings.heading }}</h2>
      {% endif %}

      {% if has_videos or has_ebooks %}
        <div class="ms-tabs" role="tablist" aria-label="Media tabs">
          {% if has_videos %}
            <button
              id="mstab-videos-{{ section.id }}"
              class="ms-tab button"
              type="button"
              role="tab"
              data-target="videos"
              aria-controls="mspanel-videos-{{ section.id }}"
              {% if active_tab == 'videos' %}aria-selected="true"{% else %}aria-selected="false"{% endif %}
            >
              {{ tab_video_label }}
            </button>
          {% endif %}

          {% if has_ebooks %}
            <button
              id="mstab-ebooks-{{ section.id }}"
              class="ms-tab button"
              type="button"
              role="tab"
              data-target="ebooks"
              aria-controls="mspanel-ebooks-{{ section.id }}"
              {% if active_tab == 'ebooks' %}aria-selected="true"{% else %}aria-selected="false"{% endif %}
            >
              {{ tab_ebook_label }}
            </button>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>

  {% if active_tab == '' %}
    <div class="page-width">
      <p>No media blocks added yet.</p>
    </div>
  {% endif %}

  {% if has_videos %}
    <div
      id="mspanel-videos-{{ section.id }}"
      class="ms-panel"
      role="tabpanel"
      aria-labelledby="mstab-videos-{{ section.id }}"
      {% unless active_tab == 'videos' %}hidden{% endunless %}
    >
      <div class="page-width" data-swiper-root>
        <div class="ts2-bleed">
          <div
            class="swiper ts2-swiper"
            data-mode="fixed"
            data-gap="{{ section.settings.gap | default: 32 }}"
            data-speed="{{ section.settings.speed | default: 500 }}"
            data-autoplay="{{ section.settings.autoplay | default: false }}"
            data-autoplay-delay="{{ section.settings.autoplay_delay | default: 4000 }}"
            data-dots="true"
          >
            <div class="swiper-wrapper">
              {%- for block in section.blocks -%}
                {%- if block.type != 'video_slide' -%}{%- continue -%}{%- endif -%}
                {%- assign b = block.settings -%}

                <div class="swiper-slide" {{ block.shopify_attributes }}>
                  <article class="ts2-card">
                    <div class="ms-media" {% if b.video_url != blank %}data-video-src="{{ b.video_url | escape }}"{% endif %}>
                      {% if b.image != blank %}
                        {{ b.image | image_url: width: 1200 | image_tag: loading: 'lazy', sizes: '(min-width: 990px) 420px, 100vw', widths: '420,640,840,1200', alt: b.name | escape }}
                      {% else %}
                        {{ 'image' | placeholder_svg_tag }}
                      {% endif %}

                      {% if b.video_url != blank %}
                        <div class="ms-overlay">
                          <button type="button" class="ms-video-btn" aria-label="Play video">
                            <svg width="39" height="44" viewBox="0 0 39 44" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path d="M36.5 17.6699C39.8333 19.5944 39.8333 24.4056 36.5 26.3301L8 42.7846C4.66667 44.7091 0.500002 42.3035 0.500002 38.4545L0.500003 5.54551C0.500003 1.69651 4.66667 -0.709112 8 1.21539L36.5 17.6699Z" fill="white"/>
                            </svg>
                          </button>
                        </div>
                      {% endif %}
                    </div>

                    <div class="ts2-copy">
                      <span class="ts2-pill">{{ section.settings.video_pill | default: 'Experts Talk' }}</span>
                      {% if b.title  != blank %}<h4 class="ts2-role">{{ b.title }}</h4>{% endif %}
                      {% if b.name  != blank %}<p class="ts2-name">{{ b.name }}</p>{% endif %}
                      {% if b.description != blank %}<p class="ts2-quote">{{ b.description | strip_html | escape }}</p>{% endif %}
                    </div>
                  </article>
                </div>
              {%- endfor -%}
            </div>
          </div>

          <div class="ms-controls">
            <div class="ms-arrows">
              <button class="ms-btn ts-prev" aria-label="Previous">
                <svg width="49" height="49" viewBox="0 0 49 49" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M45.9375 24.5C45.9375 24.0939 45.7762 23.7044 45.489 23.4172C45.2018 23.1301 44.8124 22.9687 44.4062 22.9687H8.2902L17.9279 13.3341C18.2154 13.0466 18.3769 12.6566 18.3769 12.25C18.3769 11.8434 18.2154 11.4534 17.9279 11.1659C17.6403 10.8783 17.2504 10.7168 16.8438 10.7168C16.4371 10.7168 16.0472 10.8783 15.7596 11.1659L3.5096 23.4159C3.367 23.5581 3.2539 23.7271 3.1767 23.9131C3.0995 24.0991 3.0598 24.2986 3.0598 24.5C3.0598 24.7014 3.0995 24.9008 3.1767 25.0869C3.2539 25.2729 3.367 25.4419 3.5096 25.5841L15.7596 37.8341C16.0472 38.1216 16.4371 38.2832 16.8438 38.2832C17.2504 38.2832 17.6403 38.1216 17.9279 37.8341C18.2154 37.5466 18.3769 37.1566 18.3769 36.75C18.3769 36.3434 18.2154 35.9534 17.9279 35.6659L8.2902 26.0312H44.4062C44.8124 26.0312 45.2018 25.8699 45.489 25.5828C45.7762 25.2956 45.9375 24.9061 45.9375 24.5Z" fill="#1F1946"/>
                </svg>
              </button>
              <button class="ms-btn ts-next" aria-label="Next">
                <svg width="49" height="49" viewBox="0 0 49 49" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M3.0625 24.4995C3.0625 24.0934 3.22383 23.7039 3.51099 23.4167C3.79816 23.1296 4.18764 22.9682 4.59375 22.9682H40.7098L31.0721 13.3336C30.7846 13.0461 30.6231 12.6561 30.6231 12.2495C30.6231 11.8429 30.7846 11.4529 31.0721 11.1654C31.3597 10.8778 31.7496 10.7163 32.1562 10.7163C32.5629 10.7163 32.9528 10.8778 33.2404 11.1654L45.4904 23.4154C45.633 23.5576 45.7461 23.7266 45.8233 23.9126C45.9005 24.0986 45.9402 24.2981 45.9402 24.4995C45.9402 24.7009 45.9005 24.9003 45.8233 25.0864C45.7461 25.2724 45.633 25.4414 45.4904 25.5836L33.2404 37.8336C32.9528 38.1211 32.5629 38.2827 32.1562 38.2827C31.7496 38.2827 31.3597 38.1211 31.0721 37.8336C30.7846 37.5461 30.6231 37.1561 30.6231 36.7495C30.6231 36.3429 30.7846 35.9529 31.0721 35.6654L40.7098 26.0307H4.59375C4.18764 26.0307 3.79816 25.8694 3.51099 25.5823C3.22383 25.2951 3.0625 24.9056 3.0625 24.4995Z" fill="#1F1946"/>
                </svg>
              </button>
            </div>

            <div class="ts2-pagination"></div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  {% if has_ebooks %}
    <div
      id="mspanel-ebooks-{{ section.id }}"
      class="ms-panel"
      role="tabpanel"
      aria-labelledby="mstab-ebooks-{{ section.id }}"
      {% unless active_tab == 'ebooks' %}hidden{% endunless %}
    >
      <div class="page-width" data-swiper-root>
        <div class="ts2-bleed">
          <div
            class="swiper ts2-swiper"
            data-mode="fixed"
            data-gap="{{ section.settings.gap | default: 32 }}"
            data-speed="{{ section.settings.speed | default: 500 }}"
            data-autoplay="{{ section.settings.autoplay | default: false }}"
            data-autoplay-delay="{{ section.settings.autoplay_delay | default: 4000 }}"
            data-dots="true"
          >
            <div class="swiper-wrapper">
              {%- for block in section.blocks -%}
                {%- if block.type != 'ebook_slide' -%}{%- continue -%}{%- endif -%}
                {%- assign b = block.settings -%}

                <div class="swiper-slide" {{ block.shopify_attributes }}>
                  <article class="ts2-card">
                    <div class="ms-media">
                      {% if b.image != blank %}
                        {{ b.image | image_url: width: 1200 | image_tag: loading: 'lazy', sizes: '(min-width: 990px) 420px, 100vw', widths: '420,640,840,1200', alt: b.title | escape }}
                      {% else %}
                        {{ 'image' | placeholder_svg_tag }}
                      {% endif %}

                      {% if b.pdf_url != blank %}
                        <div class="ms-overlay">
                          <a class="ms-ebook-link" href="{{ b.pdf_url }}" target="_blank" rel="noopener" aria-label="Open e-book PDF">
                            <svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path d="M14 3H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8l-5-5Z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
                              <path d="M14 3v5h5" stroke="white" stroke-width="2" stroke-linejoin="round"/>
                              <path d="M9 13h6M9 16h6" stroke="white" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                          </a>
                        </div>
                      {% endif %}
                    </div>

                    <div class="ts2-copy">
                      <span class="ts2-pill">{{ section.settings.ebook_pill | default: 'E-book' }}</span>
                      {% if b.title != blank %}<h4 class="ts2-role">{{ b.title }}</h4>{% endif %}
                      {% if b.subtitle != blank %}<p class="ts2-name">{{ b.subtitle }}</p>{% endif %}
                      {% if b.description != blank %}<p class="ts2-quote">{{ b.description | strip_html | escape }}</p>{% endif %}
                    </div>
                  </article>
                </div>
              {%- endfor -%}
            </div>
          </div>

          <div class="ms-controls">
            <div class="ms-arrows">
              <button class="ms-btn ts-prev" aria-label="Previous">
                <svg width="49" height="49" viewBox="0 0 49 49" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M45.9375 24.5C45.9375 24.0939 45.7762 23.7044 45.489 23.4172C45.2018 23.1301 44.8124 22.9687 44.4062 22.9687H8.2902L17.9279 13.3341C18.2154 13.0466 18.3769 12.6566 18.3769 12.25C18.3769 11.8434 18.2154 11.4534 17.9279 11.1659C17.6403 10.8783 17.2504 10.7168 16.8438 10.7168C16.4371 10.7168 16.0472 10.8783 15.7596 11.1659L3.5096 23.4159C3.367 23.5581 3.2539 23.7271 3.1767 23.9131C3.0995 24.0991 3.0598 24.2986 3.0598 24.5C3.0598 24.7014 3.0995 24.9008 3.1767 25.0869C3.2539 25.2729 3.367 25.4419 3.5096 25.5841L15.7596 37.8341C16.0472 38.1216 16.4371 38.2832 16.8438 38.2832C17.2504 38.2832 17.6403 38.1216 17.9279 37.8341C18.2154 37.5466 18.3769 37.1566 18.3769 36.75C18.3769 36.3434 18.2154 35.9534 17.9279 35.6659L8.2902 26.0312H44.4062C44.8124 26.0312 45.2018 25.8699 45.489 25.5828C45.7762 25.2956 45.9375 24.9061 45.9375 24.5Z" fill="#1F1946"/>
                </svg>
              </button>
              <button class="ms-btn ts-next" aria-label="Next">
                <svg width="49" height="49" viewBox="0 0 49 49" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M3.0625 24.4995C3.0625 24.0934 3.22383 23.7039 3.51099 23.4167C3.79816 23.1296 4.18764 22.9682 4.59375 22.9682H40.7098L31.0721 13.3336C30.7846 13.0461 30.6231 12.6561 30.6231 12.2495C30.6231 11.8429 30.7846 11.4529 31.0721 11.1654C31.3597 10.8778 31.7496 10.7163 32.1562 10.7163C32.5629 10.7163 32.9528 10.8778 33.2404 11.1654L45.4904 23.4154C45.633 23.5576 45.7461 23.7266 45.8233 23.9126C45.9005 24.0986 45.9402 24.2981 45.9402 24.4995C45.9402 24.7009 45.9005 24.9003 45.8233 25.0864C45.7461 25.2724 45.633 25.4414 45.4904 25.5836L33.2404 37.8336C32.9528 38.1211 32.5629 38.2827 32.1562 38.2827C31.7496 38.2827 31.3597 38.1211 31.0721 37.8336C30.7846 37.5461 30.6231 37.1561 30.6231 36.7495C30.6231 36.3429 30.7846 35.9529 31.0721 35.6654L40.7098 26.0307H4.59375C4.18764 26.0307 3.79816 25.8694 3.51099 25.5823C3.22383 25.2951 3.0625 24.9056 3.0625 24.4995Z" fill="#1F1946"/>
                </svg>
              </button>
            </div>

            <div class="ts2-pagination"></div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  <!-- shared modal (videos only) -->
  <div class="ms-modal" aria-hidden="true" role="dialog" aria-label="Video player">
    <div class="ms-modal__box">
      <button class="ms-close" type="button" aria-label="Close">âœ•</button>
      <iframe allow="autoplay; fullscreen; picture-in-picture" allowfullscreen title="Vimeo video"></iframe>
    </div>
  </div>
</section>

<script>
(() => {
  const root = document.getElementById('mixed-media-slider-{{ section.id }}');
  if (!root) return;

  // Tabs (patterned after featured-collection-tab-grid)
  const tabs = root.querySelectorAll('.ms-tab');
  const panels = {};
  ['videos','ebooks'].forEach(k => {
    const el = root.querySelector('#mspanel-' + k + '-{{ section.id }}');
    if (el) panels[k] = el;
  });

  function activate(which){
    tabs.forEach(btn => btn.setAttribute('aria-selected', btn.dataset.target === which ? 'true' : 'false'));
    Object.keys(panels).forEach(k => {
      if (k === which) panels[k]?.removeAttribute('hidden');
      else panels[k]?.setAttribute('hidden','');
    });

    // help Swiper re-measure if it was initialised while hidden
    window.dispatchEvent(new Event('resize'));
    setTimeout(() => window.dispatchEvent(new Event('resize')), 120);
  }

  tabs.forEach(btn => btn.addEventListener('click', () => activate(btn.dataset.target)));

  // Video modal (same logic as your video-slider)
  const modal  = root.querySelector('.ms-modal');
  const iframe = modal?.querySelector('iframe');
  const closeBtn = modal?.querySelector('.ms-close');

  function toVimeoEmbed(url) {
    try {
      const s = String(url);
      const m = s.match(/vimeo\.com\/(?:video\/)?(\d+)/);
      if (m && m[1]) return `https://player.vimeo.com/video/${m[1]}?autoplay=1`;
      if (s.includes('player.vimeo.com')) return s.includes('autoplay=') ? s : s + (s.includes('?') ? '&' : '?') + 'autoplay=1';
    } catch(e) {}
    return null;
  }
  function openModal(src) {
    if (!modal || !iframe) return;
    const embed = toVimeoEmbed(src);
    if (!embed) return;
    iframe.src = embed;
    modal.setAttribute('aria-hidden', 'false');
    document.documentElement.classList.add('no-scroll');
  }
  function closeModal() {
    if (!modal || !iframe) return;
    modal.setAttribute('aria-hidden', 'true');
    iframe.removeAttribute('src');
    document.documentElement.classList.remove('no-scroll');
  }

  root.addEventListener('click', (e) => {
    const btn = e.target.closest('.ms-video-btn');
    if (btn) {
      const media = btn.closest('.ms-media');
      const src = media?.dataset.videoSrc;
      if (src) openModal(src);
    }
    if (e.target === modal) closeModal();
  });

  closeBtn?.addEventListener('click', closeModal);
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); }, { passive: true });
})();
</script>

{% schema %}
{
  "name": "Mixed media slider",
  "class": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Resources" },
    { "type": "color", "id": "bg_color", "label": "Background color", "default": "#FFFFFF" },

    { "type": "header", "content": "Tabs" },
    { "type": "text", "id": "tab_video_label", "label": "Video tab label", "default": "Videos" },
    { "type": "text", "id": "tab_ebook_label", "label": "E-book tab label", "default": "E-books" },
    {
      "type": "select",
      "id": "default_tab",
      "label": "Default tab",
      "options": [
        { "value": "videos", "label": "Videos" },
        { "value": "ebooks", "label": "E-books" }
      ],
      "default": "videos"
    },

    { "type": "header", "content": "Pills" },
    { "type": "text", "id": "video_pill", "label": "Video pill text", "default": "Experts Talk" },
    { "type": "text", "id": "ebook_pill", "label": "E-book pill text", "default": "E-book" },

    { "type": "header", "content": "Slider behavior" },
    { "type": "range", "id": "gap", "label": "Slide gap (px)", "min": 0, "max": 48, "step": 2, "default": 32 },
    { "type": "range", "id": "speed", "label": "Transition speed (ms)", "min": 100, "max": 1200, "step": 50, "default": 500 },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false },
    { "type": "range", "id": "autoplay_delay", "label": "Autoplay delay (ms)", "min": 1500, "max": 8000, "step": 100, "default": 4000 },

    { "type": "header", "content": "Section padding" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding top", "default": 56 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding bottom", "default": 56 }
  ],
  "blocks": [
    {
      "type": "video_slide",
      "name": "Video slide",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image (thumbnail/poster)" },
        { "type": "text", "id": "video_url", "label": "Vimeo video URL", "default": "https://player.vimeo.com/video/903918402" },
        { "type": "text", "id": "title", "label": "Title", "default": "Manage Statin Side Effects" },
        { "type": "text", "id": "name", "label": "Name", "default": "Dr. Kahn" },
        { "type": "textarea", "id": "description", "label": "Description", "default": "Lorem Ipsum is simply dummy text of the printing and typesetting industry." }
      ]
    },
    {
      "type": "ebook_slide",
      "name": "E-book slide",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image (cover/thumbnail)" },
        { "type": "url", "id": "pdf_url", "label": "PDF URL (opens in new tab)" },
        { "type": "text", "id": "title", "label": "Title", "default": "Heart Health Guide" },
        { "type": "text", "id": "subtitle", "label": "Subtitle", "default": "Downloadable PDF" },
        { "type": "textarea", "id": "description", "label": "Description", "default": "Short description of the e-book." }
      ]
    }
  ],
  "max_blocks": 20,
  "presets": [
    {
      "name": "Mixed media slider",
      "blocks": [
        { "type": "video_slide" },
        { "type": "video_slide" },
        { "type": "ebook_slide" }
      ]
    }
  ]
}
{% endschema %}