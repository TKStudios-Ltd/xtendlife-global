{% liquid
  assign threshold_input = threshold | default: section.settings.free_shipping_threshold | default: settings.free_shipping_threshold
  if threshold_input == blank
    assign threshold_input = 0
  endif

  assign threshold_float = threshold_input | replace: ',', '.' | plus: 0
  assign threshold_cents = threshold_float | times: 100 | round

  assign subtotal_cents = cart.total_price
  assign remaining_cents = threshold_cents | minus: subtotal_cents
  if remaining_cents < 0
    assign remaining_cents = 0
  endif

  if threshold_cents > 0
    assign progress = subtotal_cents | times: 100 | divided_by: threshold_cents
  else
    assign progress = 0
  endif
  if progress > 100
    assign progress = 100
  endif
%}

{% if threshold_cents > 0 %}
  <div class="fsb" role="status" aria-live="polite">
    <div class="title-wrapper-with-link">
      <p class="fsb__text">
        {% if remaining_cents > 0 %}
            {{ remaining_cents | money }} away from free shipping
        {% else %}
            Free shipping unlocked ðŸŽ‰
        {% endif %}
        </p>
      <a href="{{ routes.all_products_collection_url }}" class="underlined-link">
        {{- 'general.continue_shopping' | t -}}
      </a>
    </div>
    <div class="fsb__bar" aria-hidden="true">
      <span class="fsb__fill" style="width: {{ progress }}%"></span>
    </div>
  </div>

  <style>
    .fsb { margin: 0; }
    .fsb__text { margin: 0 !important; font-weight:500; font-size: 1.6rem; }
    .fsb__bar { height: 9px; background:rgba(38,138,255,0.12); border-radius:999px; overflow:hidden; }
    .fsb__fill { display:block; height:100%; width:0; border-radius:999px; background:#5FC4FF; transition:width .35s ease; }
  </style>
{% endif %}
